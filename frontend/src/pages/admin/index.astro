---
export const prerender = false;

import { api } from "@/api/api-client";
import AdminLayout from "@/layouts/AdminLayout.astro";
import type {
  Experiences,
  Projects,
  CareerCertifications,
} from "@/types/types";
import { API_PATHS } from "@/utils/constants";
import { asyncThrowable } from "@/utils/utils.ts";

const user = Astro.locals.user;

const [experiences, experiencesError] = await asyncThrowable<Experiences>(() =>
  api.get<Experiences>(API_PATHS.EXPERIENCES)
);
console.error({ experiencesError });

const experienceCount = experiences?.length ?? 0;

const [projects, projectsError] = await asyncThrowable<Projects>(() =>
  api.get<Projects>(API_PATHS.PROJECTS)
);
console.error({ projectsError });

const projectCount = projects?.length ?? 0;

const [certifications, certificationsError] =
  await asyncThrowable<CareerCertifications>(() =>
    api.get<CareerCertifications>(API_PATHS.UPLOAD_CERTIFICATES)
  );
console.error({ certificationsError });

const certificationCount = certifications?.length ?? 0;
---

<AdminLayout title="Dashboard" currentPath="/admin" user={user}>
  <div class="admin-stats-grid">
    <a href="/admin/experiences" class="admin-stat-card stat-link">
      <div class="admin-stat-label">Experiences</div>
      <div class="admin-stat-value">{experienceCount}</div>
    </a>
    <a href="/admin/projects" class="admin-stat-card stat-link">
      <div class="admin-stat-label">Projects</div>
      <div class="admin-stat-value">{projectCount}</div>
    </a>
    <a href="/admin/certifications" class="admin-stat-card stat-link">
      <div class="admin-stat-label">Certifications</div>
      <div class="admin-stat-value">{certificationCount}</div>
    </a>
  </div>

  <div class="admin-card">
    <div class="admin-card-header">
      <h2 class="admin-card-title">Quick Actions</h2>
    </div>
    <div class="quick-actions">
      <a href="/admin/experiences" class="quick-action-item">
        <div class="quick-action-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
          </svg>
        </div>
        <div class="quick-action-content">
          <h3>Manage Experiences</h3>
          <p>Add, edit, or remove work experiences</p>
        </div>
      </a>
      <a href="/admin/projects" class="quick-action-item">
        <div class="quick-action-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"
            ></path>
          </svg>
        </div>
        <div class="quick-action-content">
          <h3>Manage Projects</h3>
          <p>Showcase your latest projects</p>
        </div>
      </a>
      <a href="/admin/certifications" class="quick-action-item">
        <div class="quick-action-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="8" r="7"></circle>
            <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"
            ></polyline>
          </svg>
        </div>
        <div class="quick-action-content">
          <h3>Manage Certifications</h3>
          <p>Upload and manage certificates</p>
        </div>
      </a>
      <a href="/" class="quick-action-item" target="_blank" rel="noopener">
        <div class="quick-action-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"
            ></path>
            <polyline points="15 3 21 3 21 9"></polyline>
            <line x1="10" y1="14" x2="21" y2="3"></line>
          </svg>
        </div>
        <div class="quick-action-content">
          <h3>View Portfolio</h3>
          <p>Open your public portfolio site</p>
        </div>
      </a>
    </div>
  </div>
</AdminLayout>

<style>
  .stat-link {
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .stat-link:hover {
    transform: translateY(-2px);
    border-color: var(--admin-primary);
  }

  .quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
  }

  .quick-action-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem;
    background: var(--admin-bg);
    border: 1px solid var(--admin-border);
    border-radius: 0.5rem;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .quick-action-item:hover {
    border-color: var(--admin-primary);
    background: var(--admin-bg-tertiary);
  }

  .quick-action-icon {
    width: 40px;
    height: 40px;
    flex-shrink: 0;
    background: linear-gradient(135deg, var(--admin-primary), #a78bfa);
    border-radius: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
  }

  .quick-action-icon svg {
    width: 20px;
    height: 20px;
  }

  .quick-action-content h3 {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--admin-text);
    margin: 0 0 0.25rem;
  }

  .quick-action-content p {
    font-size: 0.8125rem;
    color: var(--admin-text-muted);
    margin: 0;
  }
</style>
